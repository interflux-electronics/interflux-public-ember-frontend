<div class='liner'>
  <BackNav @backRoute='home.products' @backLabel='All products' />

  <div class='columns'>
    {{#if this.media.isDesktopWidescreen}}
      <aside>
        <div class='sticky'>
          <fieldset id='search'>
            <legend>Find a product</legend>
            <Search
              @placeholder={{this.searchPlaceHolder}}
              @onSelect={{this.openProductPage}}
              @searchModel='product'
              @searchLabel='name'
              @searchFilter='name'
              @minKeyStrokes='1'
            />
          </fieldset>

          <fieldset>
            <legend>Products we develop</legend>
            <ul class='links'>
              {{#each this.familyRadios as |radio|}}
                <li>
                  <a
                    href={{href-to 'home.products.subset' radio.id}}
                    class={{if radio.isChecked 'active'}}
                    {{on 'click' (fn this.openSubsetPage radio.id)}}
                  >
                    <span class='label'>{{radio.label}}</span>
                    <Svg::ArrowRight />
                  </a>
                </li>
              {{/each}}
            </ul>
          </fieldset>

          <fieldset>
            <legend>Processes we support</legend>
            <ul class='links'>
              {{#each this.useRadios as |radio|}}
                <li>
                  <a
                    href={{href-to 'home.products.subset' radio.id}}
                    class={{if radio.isChecked 'active'}}
                    {{on 'click' (fn this.openSubsetPage radio.id)}}
                  >
                    <span class='label'>{{radio.label}}</span>
                    <Svg::ArrowRight />
                  </a>
                </li>
              {{/each}}
            </ul>
          </fieldset>

          <fieldset>
            <legend>Filter</legend>
            {{#each this.statusCheckboxes as |checkbox|}}
              <div class='checkbox-group'>
                <Checkbox
                  @id={{checkbox.id}}
                  @checked={{checkbox.isChecked}}
                  @onClick={{fn this.toggleStatus checkbox.id}}
                />
                <label for='input-{{checkbox.id}}'>
                  <span>{{checkbox.label}}&nbsp;</span>
                  {{!--<small>{{checkbox.count}}</small>--}}
                </label>
              </div>
            {{/each}}
          </fieldset>
        </div>
      </aside>
    {{/if}}

    <article {{did-insert this.onInsertArticle}}>
      <h1 id='h1'>{{this.pageTitle}}</h1>

      {{#if this.isLoading}}
        <Shimmer::ProductRows::Desktop />
      {{else}}
        {{#if this.groupByAlloy}}
          {{#each this.sections as |s|}}
            {{#if (or s.visibleRows.length s.visibleRows.length)}}
              <section>
                <div class='intro'>
                  <h2>{{s.title}}</h2>
                </div>

                <ul class='visible'>
                  {{#each s.visibleRows as |row|}}
                    <ProductRow
                      @product={{row.product}}
                      @avatar={{row.avatar}}
                    />
                  {{/each}}
                </ul>
                {{#if s.hiddenRows.length}}
                  <Button
                    @text='Show {{s.hiddenRows.length}} more'
                    @icon='arrow-down'
                    @theme='secondary medium grey-border blue-focus icon-right'
                    @onClick={{this.toggleHiddenRows}}
                    @class='expand'
                  />

                  <ul class='hidden'>
                    {{#each s.hiddenRows as |row|}}
                      <ProductRow
                        @product={{row.product}}
                        @avatar={{row.avatar}}
                      />
                    {{/each}}
                  </ul>

                  <Button
                    @text='Hide outdated products'
                    @icon='arrow-up'
                    @theme='secondary medium grey-border blue-focus icon-right'
                    @onClick={{this.toggleHiddenRows}}
                    @class='collapse'
                  />
                {{/if}}
              </section>
            {{/if}}
          {{/each}}
        {{else}}
          <ol>
            {{#each this.mainFamilies as |mainFamily|}}
              <li
                id={{mainFamily.id}}
                class='main-family-for-use'
                labelledby='h2-{{mainFamily.id}}'
              >
                <div class='intro'>
                  <div class='title'>
                    <h2 id='h2-{{mainFamily.id}}'>{{mainFamily.label}}
                      for
                      {{this.use.text}}</h2>
                  </div>
                </div>
              </li>

              <li
                id='other-{{mainFamily.id}}'
                class='sub-family'
                labelledby='h2-other-{{mainFamily.id}}'
              >
                <div class='intro'>
                  <div class='title'>
                    <h2 id='h2-other-{{mainFamily.id}}'>Other
                      {{mainFamily.namePlural}}</h2>
                  </div>
                </div>
              </li>
            {{/each}}

            {{#each this.subFamilies as |subFamily|}}
              <li
                id={{subFamily.id}}
                class='sub-family'
                labelledby='h2-{{subFamily.id}}'
              >
                <div class='intro'>
                  <div class='title'>
                    <h2 id='h2-{{subFamily.id}}'>{{subFamily.label}}</h2>
                  </div>
                </div>
              </li>
            {{/each}}

            {{#each this.sortedProducts as |product|}}
              <ProductRow @product={{product}} />
            {{/each}}
          </ol>
        {{/if}}
      {{/if}}
    </article>
  </div>
</div>